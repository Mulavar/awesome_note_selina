## 进程与线程的联系

### 区别

进程是系统进行资源分配和调度的一个独立单位（资源的基本单位）。

线程是CPU调度和分派的基本单位（运行的基本单位）。



同一进程中的多个线程共享**代码段(代码和常量)，数据段(全局变量和静态变量)，扩展段(堆存储)**。

每个线程拥有自己的栈段，栈段又叫运行时段，用来存放所有局部变量和临时变量。



### 为什么进程切换比线程切换开销大？

进程切换分为两步：

1. 切换页目录以使用新的地址空间（进程的数据段代码段要换出去，以便把将要执行的进程的内容换进来）
2. 切换内核栈和硬件上下文

线程切换只用做第二步，只需要保存**线程的上下文（相关寄存器状态和栈的信息）**，且进程切换完后一些缓存（如TLB页表缓存）都失效，有一段时间都需要直接访问内存。







## 线程和协程的区别

协程更轻量级，调度是在用户态进行，Go的调度器不是由硬件时钟来定期触发的，而是由特定的go语言结构来触发的，他不需要切换到内核语境。

go协程的栈空间更灵活

goroutine没有一个特定的标识。